{% extends "layout.html" %}
{% block contenido %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movil liviano</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        .enlace1, .enlace8 {
            display: inline-block;
            color: beige;
            text-decoration: none;
            background-color: rgb(79, 101, 121);
            padding: 0.5px;
            margin: 25px 0px;
        }
        .table-container {
            margin: 0.5px auto;
            background-color: rgb(253, 253, 253);;
            padding: 0.5px;
            border-radius: 3px;
            box-shadow: 0 0 10px rgb(245, 235, 235);
            max-width: 150%;
        }
        .table {
            font-size: 0.7em;
        }
        th, td {
            padding: 8px;
        }
        body {
            background-color:rgb(181, 218, 216);
        }
        .btn-atender {
            background-color: red;
            color: white;
        }
        .btn-atendido {
            background-color: green;
            color: white;
        }
    </style>
</head>
<body>
    <div class="top-left">
        <a class="enlace1" href="inicio" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            ⭠ INICIO    
         </a>
         <a class="enlace8" href="/moviles" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            ⭠ REGRESAR    
         </a>
    </div>
    <h1 style="text-align: center; color: rgb(12, 144, 206);">SUPER LIDER FLEYDER HDEZ TIENES ESTAS ORDENES ASIGNADAS</h1>

    <div class="table-container">
        <table class="table table-striped table-bordered">
            <thead class="thead-dark">
             <tr>
             <th scope="col">ID</th>
             <th scope="col">Dirección Falla</th>
             <th scope="col">Localidad</th>
            <th scope="col">Tipo Falla</th>
             <th scope="col">Estado</th>
          </tr>
            </thead>
     <tbody>
        {% for orden in ordenes %} 
        <tr>
          <td>{{ orden.id }}</td>
          <td>{{ orden.direccion_falla }}</td>
          <td>{{ orden.localidad.value }}</td>
          <td>{{ orden.tipo_falla.value }}</td>
          <td>
            {% if orden.estado.value == 'CERRADA' %}
           <button class="btn-atendido" disabled>Atendido</button>
             {% else %}
              <form action="/completar_orden" method="post" style="display: inline;" onsubmit="return changeButtonState(this)">
              <input type="hidden" name="orden_id" value="{{ orden.id }}">
             <button class="cerrar-orden-btn btn-atender" data-id="{{ orden.id }}">Por Atender</button>
            </form>
              {% endif %}

        </td>
        
                 </tr>
              {% endfor %}    
                </tbody>
                 </table>
             </div>
         
             <script>                 
                 function changeButtonState(form) {
                     var button = form.querySelector("button"); 
                     button.textContent = "Atendido"; 
                     button.classList.remove("btn-atender");
                     button.classList.add("btn-atendido");
                     return false; 
                 }
             </script>
         </body>

         

         <script>
            document.addEventListener("DOMContentLoaded", function () {
                const botonesCerrarOrden = document.querySelectorAll(".cerrar-orden-btn");
            
                botonesCerrarOrden.forEach(boton => {
                    boton.addEventListener("click", function () {
                        const ordenId = this.getAttribute("data-id");
            
                        fetch("/cerrar_orden", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ orden_id: ordenId })
                        })
                        .then(response => response.json())
                        .then(data => {
                            
                        })
                        .catch(error => console.error("Error:", error));
                    });
                });
            });
            </script>
            
        
         
         {% endblock contenido %}